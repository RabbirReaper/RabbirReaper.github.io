



<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/https:/pub-da440be71028438aa9683b63bef5ccf1.r2.devimages/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/https:/pub-da440be71028438aa9683b63bef5ccf1.r2.dev/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="プログラムを書けないうさぎは、ただのうさぎだ。" href="https://rabbirreaper.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="プログラムを書けないうさぎは、ただのうさぎだ。" href="https://rabbirreaper.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="プログラムを書けないうさぎは、ただのうさぎだ。" href="https://rabbirreaper.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="Hexo,Mermaid,除錯紀錄" />


<link rel="canonical" href="https://rabbirreaper.github.io/2026/01/09/hexo-mermaid-fix/">



  <title>
Hexo Shoka 主題 Mermaid 渲染問題排查與修復 - Hexo |
Rabbir Reaper = プログラムを書けないうさぎは、ただのうさぎだ。</title>
<meta name="generator" content="Hexo 8.1.1"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Hexo Shoka 主題 Mermaid 渲染問題排查與修復
  </h1>
  
<div class="meta">
  <span class="item" title="創建時間：2026-01-09 13:44:16">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">發表於</span>
    <time itemprop="dateCreated datePublished" datetime="2026-01-09T13:44:16+08:00">2026-01-09</time>
  </span>
  <span class="item" title="文章字數">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">文章字數</span>
    <span>22k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="所需閱讀時間">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">所需閱讀時間</span>
    <span>20 分鐘</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切換導航欄">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Rabbir Reaper</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://pub-da440be71028438aa9683b63bef5ccf1.r2.dev/100.jpg"></li>
          <li class="item" data-background-image="https://pub-da440be71028438aa9683b63bef5ccf1.r2.dev/26.jpg"></li>
          <li class="item" data-background-image="https://pub-da440be71028438aa9683b63bef5ccf1.r2.dev/72.jpg"></li>
          <li class="item" data-background-image="https://pub-da440be71028438aa9683b63bef5ccf1.r2.dev/77.jpg"></li>
          <li class="item" data-background-image="https://pub-da440be71028438aa9683b63bef5ccf1.r2.dev/68.jpg"></li>
          <li class="item" data-background-image="https://pub-da440be71028438aa9683b63bef5ccf1.r2.dev/53.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">首頁</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Hexo/" itemprop="item" rel="index" title="分類於 Hexo"><span itemprop="name">Hexo</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-TW">
  <link itemprop="mainEntityOfPage" href="https://rabbirreaper.github.io/2026/01/09/hexo-mermaid-fix/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/https:/pub-da440be71028438aa9683b63bef5ccf1.r2.dev/images/avatar.jpg">
    <meta itemprop="name" content="Rabbir">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="プログラムを書けないうさぎは、ただのうさぎだ。">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="前言"><a class="anchor" href="#前言">#</a> 前言</h1>
<p>Mermaid 作為 Markdown 的流程圖繪製解決方案，大大增加了 Markdown 的實用性。在搭建 Hexo 部落格時，我選擇了 Shoka 主題，它宣稱支援豐富的 Markdown 語法，包括 Mermaid。然而，在實際使用時卻發現 Mermaid 代碼塊無法正確渲染，只能顯示純文字。</p>
<p>本文記錄了完整的問題排查與修復過程。</p>
<h1 id="初始環境狀態"><a class="anchor" href="#初始環境狀態">#</a> 初始環境狀態</h1>
<h2 id="package-依賴"><a class="anchor" href="#package-依賴">#</a> Package 依賴</h2>
<p>專案已安裝以下主要依賴：</p>
<figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"hexo"</span><span class="token operator">:</span> <span class="token string">"^8.1.1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"hexo-renderer-multi-markdown-it"</span><span class="token operator">:</span> <span class="token string">"^0.1.4"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">"puppeteer"</span><span class="token operator">:</span> <span class="token string">"^23.11.1"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>hexo-renderer-multi-markdown-it</code>  是一個強大的 Markdown 渲染器，內建支援多種插件，包括  <code>markdown-it-mermaid</code> 。</p>
<h2 id="hexo-主配置_configyml"><a class="anchor" href="#hexo-主配置_configyml">#</a> Hexo 主配置（_config.yml）</h2>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 語法高亮設置</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">syntax_highlighter</span><span class="token punctuation">:</span> highlight.js</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">highlight</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">line_number</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">auto_detect</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">tab_replace</span><span class="token punctuation">:</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">wrap</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">hljs</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">exclude_languages</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">-</span> mermaid</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># Markdown 設置</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token key atrule">markdown</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token key atrule">render</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token key atrule">html</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token key atrule">xhtmlOut</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token key atrule">breaks</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token key atrule">linkify</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token key atrule">plugins</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">-</span> <span class="token key atrule">plugin</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token key atrule">name</span><span class="token punctuation">:</span> markdown<span class="token punctuation">-</span>it<span class="token punctuation">-</span>toc<span class="token punctuation">-</span>and<span class="token punctuation">-</span>anchor</pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment"># ... 其他插件</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment"># 注意：沒有 markdown-it-mermaid 配置</span></pre></td></tr></table></figure><h2 id="shoka-主題配置themesshoka_configyml"><a class="anchor" href="#shoka-主題配置themesshoka_configyml">#</a> Shoka 主題配置（themes/shoka/_config.yml）</h2>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">vendors</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">css</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">katex</span><span class="token punctuation">:</span> npm/katex@0.12.0/dist/katex.min.css</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">mermaid</span><span class="token punctuation">:</span> css/mermaid.css  <span class="token comment"># 只有 CSS</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">js</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">pace</span><span class="token punctuation">:</span> npm/pace<span class="token punctuation">-</span>js@1.0.2/pace.min.js</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment"># ... 其他 JS</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment"># 注意：沒有 mermaid.js</span></pre></td></tr></table></figure><h1 id="問題現象"><a class="anchor" href="#問題現象">#</a> 問題現象</h1>
<p>在 Markdown 文件中使用 Mermaid 語法：</p>
<figure class="highlight markdown"><figcaption data-lang="markdown"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token front-matter-block"><span class="token punctuation">---</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token front-matter yaml language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> 測試文章</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">mermaid</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">---</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token code"><span class="token punctuation">```</span><span class="token code-language">mermaid</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token code-block language-mermaid">graph LR</pre></td></tr><tr><td data-num="8"></td><td><pre>    A[Square Rect] --> B((Circle))</pre></td></tr><tr><td data-num="9"></td><td><pre>    A --> C(Round Rect)</pre></td></tr><tr><td data-num="10"></td><td><pre>    B --> D&#123;Rhombus&#125;</pre></td></tr><tr><td data-num="11"></td><td><pre>    C --> D</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">```</span></span></pre></td></tr></table></figure><p>渲染結果：代碼塊被當作普通代碼顯示，沒有轉換成流程圖 SVG。</p>
<h1 id="排查過程"><a class="anchor" href="#排查過程">#</a> 排查過程</h1>
<h2 id="第一步檢查生成的-html"><a class="anchor" href="#第一步檢查生成的-html">#</a> 第一步：檢查生成的 HTML</h2>
<p>查看生成的 HTML 文件：</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>highlight mermaid<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>graph LR</pre></td></tr><tr><td data-num="3"></td><td><pre>    A[Square Rect] -- Link text --<span class="token entity named-entity" title="&gt;">&amp;gt;</span> B((Circle))</pre></td></tr><tr><td data-num="4"></td><td><pre>    ...</pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p><strong>發現問題 #1</strong>：Mermaid 代碼塊被渲染成了  <code>&lt;code class=&quot;highlight mermaid&quot;&gt;</code>  而不是被  <code>markdown-it-mermaid</code>  插件處理。</p>
<h2 id="第二步添加調試代碼"><a class="anchor" href="#第二步添加調試代碼">#</a> 第二步：添加調試代碼</h2>
<p>在  <code>node_modules/hexo-renderer-multi-markdown-it/lib/renderer/markdown-it-mermaid/index.js</code>  中添加調試：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function-variable function">fence</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">const</span> token <span class="token operator">=</span> tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">const</span> code <span class="token operator">=</span> token<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Token info:'</span><span class="token punctuation">,</span> token<span class="token punctuation">.</span>info<span class="token punctuation">,</span> <span class="token string">'&lt;------ equals mermaid?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>info <span class="token operator">===</span> <span class="token string">'mermaid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>info <span class="token operator">===</span> <span class="token string">'mermaid'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">defaultRenderer</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>執行  <code>hexo generate</code> ，卻沒有看到任何 console.log 輸出。</p>
<p><strong>發現問題 #2</strong>： <code>markdown-it-mermaid</code>  插件根本沒有被執行。</p>
<h2 id="第三步檢查插件載入"><a class="anchor" href="#第三步檢查插件載入">#</a> 第三步：檢查插件載入</h2>
<p>在  <code>node_modules/hexo-renderer-multi-markdown-it/lib/renderer/index.js</code>  添加調試：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>parser <span class="token operator">=</span> plugins<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">parser<span class="token punctuation">,</span> plugins</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>plugins<span class="token punctuation">.</span>enable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">let</span> plugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>plugins<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>plugins<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'mermaid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Loading mermaid plugin:'</span><span class="token punctuation">,</span> plugins<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'enabled:'</span><span class="token punctuation">,</span> plugins<span class="token punctuation">.</span>enable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> parser<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>重新生成後看到：</p>
<pre><code>Mermaid plugin is DISABLED: ./markdown-it-mermaid enabled: false
</code></pre>
<p><strong>發現問題 #3</strong>：雖然  <code>hexo-renderer-multi-markdown-it</code>  內建 mermaid 插件，但在  <code>_config.yml</code>  中沒有明確啟用。</p>
<h2 id="第四步啟用-mermaid-插件"><a class="anchor" href="#第四步啟用-mermaid-插件">#</a> 第四步：啟用 Mermaid 插件</h2>
<p>在  <code>_config.yml</code>  中添加：</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">markdown</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">plugins</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment"># ... 其他插件</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">-</span> <span class="token key atrule">plugin</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token key atrule">name</span><span class="token punctuation">:</span> ./markdown<span class="token punctuation">-</span>it<span class="token punctuation">-</span>mermaid</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token key atrule">options</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>          <span class="token key atrule">theme</span><span class="token punctuation">:</span> default</pre></td></tr></table></figure><p>再次生成，看到：</p>
<pre><code>Loading mermaid plugin: ./markdown-it-mermaid enabled: true
</code></pre>
<p>但生成的 HTML 仍然是  <code>&lt;code class=&quot;highlight mermaid&quot;&gt;</code> 。</p>
<p><strong>發現問題 #4</strong>：代碼塊在到達  <code>markdown-it-mermaid</code>  之前就被 Hexo 的內建高亮器處理了。</p>
<h2 id="第五步禁用-hexo-內建語法高亮"><a class="anchor" href="#第五步禁用-hexo-內建語法高亮">#</a> 第五步：禁用 Hexo 內建語法高亮</h2>
<p>修改  <code>_config.yml</code> ：</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">syntax_highlighter</span><span class="token punctuation">:</span>  <span class="token comment"># 設為空值</span></pre></td></tr></table></figure><p>重新生成後，終於看到  <code>Token info</code>  輸出了！但是：</p>
<pre><code>Prism encountered mermaid! lang: mermaid info: mermaid
Token info:  &lt;------ equals mermaid? false
</code></pre>
<p>查看生成的 HTML：</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>figure</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>highlight mermaid<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>figcaption</span> <span class="token attr-name">data-lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mermaid<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>figcaption</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">data-num</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>token keyword<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>graph<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span> LR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">&lt;!-- Prism 語法高亮的結果 --></span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>figure</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p><strong>發現問題 #5</strong>：代碼塊被  <code>markdown-it-prism</code>  插件進行了語法高亮，而不是交給  <code>markdown-it-mermaid</code>  處理。</p>
<p>原因是在  <code>hexo-renderer-multi-markdown-it/lib/renderer/index.js</code>  中，插件加載順序為：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> default_plugins <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token string">'./markdown-it-mermaid'</span><span class="token punctuation">,</span>   <span class="token comment">// 第 19 個</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string">'./markdown-it-prism'</span><span class="token punctuation">,</span>     <span class="token comment">// 第 21 個（最後處理）</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>Prism 插件在 Mermaid 之後加載，會覆蓋  <code>md.renderer.rules.fence</code> 。</p>
<h2 id="第六步修改-prism-跳過-mermaid"><a class="anchor" href="#第六步修改-prism-跳過-mermaid">#</a> 第六步：修改 Prism 跳過 Mermaid</h2>
<p>在  <code>node_modules/hexo-renderer-multi-markdown-it/lib/renderer/markdown-it-prism/index.js</code>  中，在處理代碼塊的開頭添加：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function-variable function">fence</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">const</span> token <span class="token operator">=</span> tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">const</span> info <span class="token operator">=</span> token<span class="token punctuation">.</span>info</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">const</span> text <span class="token operator">=</span> token<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">const</span> lang <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// Skip mermaid - let it be handled by markdown-it-mermaid</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>lang<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'mermaid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> <span class="token function">defaultRenderer</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">//... Prism 處理其他語言</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="第七步驗證修復"><a class="anchor" href="#第七步驗證修復">#</a> 第七步：驗證修復</h2>
<p>重新生成後，查看 HTML：</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mermaid graph<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mermaid-...<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">&lt;!-- 完整的 SVG 流程圖 --></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>成功！Mermaid 代碼塊被正確渲染成 SVG 了。</p>
<h1 id="完整解決方案"><a class="anchor" href="#完整解決方案">#</a> 完整解決方案</h1>
<h2 id="1-禁用-hexo-內建語法高亮"><a class="anchor" href="#1-禁用-hexo-內建語法高亮">#</a> 1. 禁用 Hexo 內建語法高亮</h2>
<p><strong>檔案</strong>： <code>_config.yml</code></p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 將 syntax_highlighter 設為空值</span></pre></td></tr><tr><td data-num="2"></td><td><pre>syntax_highlighter<span class="token punctuation">:</span></pre></td></tr></table></figure><h2 id="2-啟用-markdown-it-mermaid-插件"><a class="anchor" href="#2-啟用-markdown-it-mermaid-插件">#</a> 2. 啟用 markdown-it-mermaid 插件</h2>
<p><strong>檔案</strong>： <code>_config.yml</code></p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">markdown</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">plugins</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment"># ... 其他插件</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">-</span> <span class="token key atrule">plugin</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token key atrule">name</span><span class="token punctuation">:</span> ./markdown<span class="token punctuation">-</span>it<span class="token punctuation">-</span>mermaid</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token key atrule">options</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>          <span class="token key atrule">theme</span><span class="token punctuation">:</span> default</pre></td></tr></table></figure><h2 id="3-修改-prism-跳過-mermaid-處理"><a class="anchor" href="#3-修改-prism-跳過-mermaid-處理">#</a> 3. 修改 Prism 跳過 Mermaid 處理</h2>
<p><strong>檔案</strong>： <code>node_modules/hexo-renderer-multi-markdown-it/lib/renderer/markdown-it-prism/index.js</code></p>
<p>在  <code>md.renderer.rules.fence</code>  函數開頭添加：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Skip mermaid - let it be handled by markdown-it-mermaid</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>lang<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'mermaid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">defaultRenderer</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="4-可選配置前端-mermaidjs-渲染"><a class="anchor" href="#4-可選配置前端-mermaidjs-渲染">#</a> 4. （可選）配置前端 Mermaid.js 渲染</h2>
<p>如果要使用前端渲染而非構建時渲染，還需：</p>
<p><strong>檔案</strong>： <code>themes/shoka/_config.yml</code></p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">vendors</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">js</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">mermaid</span><span class="token punctuation">:</span> npm/mermaid@8.13.5/dist/mermaid.min.js</pre></td></tr></table></figure><p><strong>檔案</strong>： <code>themes/shoka/source/js/_app/pjax.js</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vendorCss</span><span class="token punctuation">(</span><span class="token string">'mermaid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">vendorJs</span><span class="token punctuation">(</span><span class="token string">'mermaid'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>mermaid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    mermaid<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token string">'default'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token literal-property property">startOnLoad</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token literal-property property">flowchart</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token literal-property property">useMaxWidth</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token literal-property property">htmlLabels</span><span class="token operator">:</span> <span class="token boolean">false</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    mermaid<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token string">'.mermaid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>mermaid<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h1 id="使用方法"><a class="anchor" href="#使用方法">#</a> 使用方法</h1>
<p>在文章的 Front Matter 中添加  <code>mermaid: true</code> ：</p>
<figure class="highlight markdown"><figcaption data-lang="markdown"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token front-matter-block"><span class="token punctuation">---</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token front-matter yaml language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> 我的文章</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">mermaid</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">---</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token code"><span class="token punctuation">```</span><span class="token code-language">mermaid</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token code-block language-mermaid">graph TD</pre></td></tr><tr><td data-num="8"></td><td><pre>    A[開始] --> B&#123;判斷&#125;</pre></td></tr><tr><td data-num="9"></td><td><pre>    B -->|是| C[執行]</pre></td></tr><tr><td data-num="10"></td><td><pre>    B -->|否| D[結束]</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">```</span></span></pre></td></tr></table></figure><h1 id="驗證效果"><a class="anchor" href="#驗證效果">#</a> 驗證效果</h1>
<p>以下是三個測試範例：</p>
<h2 id="範例-1流程圖"><a class="anchor" href="#範例-1流程圖">#</a> 範例 1：流程圖</h2>
<pre class="mermaid graph"><svg id="mermaid-1767941302307" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="167" style="max-width: 497.7718811035156px;" viewBox="0 0 497.7718811035156 167"><style>#mermaid-1767941302307{font-family:"trebuchet ms",verdana,arial;font-size:16px;fill:#333;}#mermaid-1767941302307 .error-icon{fill:#552222;}#mermaid-1767941302307 .error-text{fill:#552222;stroke:#552222;}#mermaid-1767941302307 .edge-thickness-normal{stroke-width:2px;}#mermaid-1767941302307 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1767941302307 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1767941302307 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1767941302307 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1767941302307 .marker{fill:#333333;}#mermaid-1767941302307 .marker.cross{stroke:#333333;}#mermaid-1767941302307 svg{font-family:"trebuchet ms",verdana,arial;font-size:16px;}#mermaid-1767941302307 .label{font-family:"trebuchet ms",verdana,arial;color:#333;}#mermaid-1767941302307 .label text{fill:#333;}#mermaid-1767941302307 .node rect,#mermaid-1767941302307 .node circle,#mermaid-1767941302307 .node ellipse,#mermaid-1767941302307 .node polygon,#mermaid-1767941302307 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1767941302307 .node .label{text-align:center;}#mermaid-1767941302307 .node.clickable{cursor:pointer;}#mermaid-1767941302307 .arrowheadPath{fill:#333333;}#mermaid-1767941302307 .edgePath .path{stroke:#333333;stroke-width:1.5px;}#mermaid-1767941302307 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1767941302307 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1767941302307 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1767941302307 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1767941302307 .cluster text{fill:#333;}#mermaid-1767941302307 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial;font-size:12px;background:hsl(80,100%,96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1767941302307:root{--mermaid-font-family:"trebuchet ms",verdana,arial;}#mermaid-1767941302307 flowchart{fill:apa;}</style><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;"><path class="path" d="M103.65391791044776,69.75L171.0390625,39L247.625,39" marker-end="url(#arrowhead15)" style="fill:none"></path><defs><marker id="arrowhead15" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-A LE-C" id="L-A-C" style="opacity: 1;"><path class="path" d="M103.65391791044776,108.75L171.0390625,139.5L228.234375,139.5" marker-end="url(#arrowhead16)" style="fill:none"></path><defs><marker id="arrowhead16" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-B LE-D" id="L-B-D" style="opacity: 1;"><path class="path" d="M309.625,39L354.015625,39L400.8184709260876,68.44715483685182" marker-end="url(#arrowhead17)" style="fill:none"></path><defs><marker id="arrowhead17" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-C LE-D" id="L-C-D" style="opacity: 1;"><path class="path" d="M329.015625,139.5L354.015625,139.5L400.81846998718345,111.05284575012297" marker-end="url(#arrowhead18)" style="fill:none"></path><defs><marker id="arrowhead18" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(171.0390625,39)" style="opacity: 1;"><g transform="translate(-32.1953125,-9.5)" class="label"><rect rx="0" ry="0" width="64.359375" height="19.03125"></rect><text><tspan xml:space="preserve" dy="1em" x="1">Link text</tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g></g><g class="nodes"><g class="node default" id="flowchart-A-8" transform="translate(60.921875,89.25)" style="opacity: 1;"><rect rx="0" ry="0" x="-52.921875" y="-19.5" width="105.84375" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-42.921875,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Square Rect</tspan></text></g></g></g><g class="node default" id="flowchart-B-9" transform="translate(278.625,39)" style="opacity: 1;"><circle x="-31" y="-19.5" r="31" class="label-container"></circle><g class="label" transform="translate(0,0)"><g transform="translate(-21,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Circle</tspan></text></g></g></g><g class="node default" id="flowchart-C-11" transform="translate(278.625,139.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-50.390625" y="-19.5" width="100.78125" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-40.390625,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Round Rect</tspan></text></g></g></g><g class="node default" id="flowchart-D-13" transform="translate(434.39374923706055,89.25)" style="opacity: 1;"><polygon points="55.378125000000004,0 110.75625000000001,-55.378125000000004 55.378125000000004,-110.75625000000001 0,-55.378125000000004" transform="translate(-55.378125000000004,55.378125000000004)" class="label-container"></polygon><g class="label" transform="translate(0,0)"><g transform="translate(-32.03125,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Rhombus</tspan></text></g></g></g></g></g></g></svg></pre><h2 id="範例-2序列圖"><a class="anchor" href="#範例-2序列圖">#</a> 範例 2：序列圖</h2>
<pre class="mermaid"><svg id="mermaid-1767941302810" width="100%" xmlns="http://www.w3.org/2000/svg" height="257" style="max-width: 493px;" viewBox="-50 -10 493 257"><style>#mermaid-1767941302810{font-family:"trebuchet ms",verdana,arial;font-size:16px;fill:#333;}#mermaid-1767941302810 .error-icon{fill:#552222;}#mermaid-1767941302810 .error-text{fill:#552222;stroke:#552222;}#mermaid-1767941302810 .edge-thickness-normal{stroke-width:2px;}#mermaid-1767941302810 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1767941302810 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1767941302810 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1767941302810 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1767941302810 .marker{fill:#333333;}#mermaid-1767941302810 .marker.cross{stroke:#333333;}#mermaid-1767941302810 svg{font-family:"trebuchet ms",verdana,arial;font-size:16px;}#mermaid-1767941302810 .actor{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1767941302810 text.actor &gt; tspan{fill:black;stroke:none;}#mermaid-1767941302810 .actor-line{stroke:grey;}#mermaid-1767941302810 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-1767941302810 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-1767941302810 #arrowhead path{fill:#333;stroke:#333;}#mermaid-1767941302810 .sequenceNumber{fill:white;}#mermaid-1767941302810 #sequencenumber{fill:#333;}#mermaid-1767941302810 #crosshead path{fill:#333;stroke:#333;}#mermaid-1767941302810 .messageText{fill:#333;stroke:#333;}#mermaid-1767941302810 .labelBox{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1767941302810 .labelText,#mermaid-1767941302810 .labelText &gt; tspan{fill:black;stroke:none;}#mermaid-1767941302810 .loopText,#mermaid-1767941302810 .loopText &gt; tspan{fill:black;stroke:none;}#mermaid-1767941302810 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:hsl(259.6261682243,59.7765363128%,87.9019607843%);}#mermaid-1767941302810 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-1767941302810 .noteText,#mermaid-1767941302810 .noteText &gt; tspan{fill:black;stroke:none;}#mermaid-1767941302810 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-1767941302810 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-1767941302810 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-1767941302810:root{--mermaid-font-family:"trebuchet ms",verdana,arial;}#mermaid-1767941302810 sequence{fill:apa;}</style><g></g><g><line id="actor0" x1="75" y1="5" x2="75" y2="246" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="75" dy="0">Alice</tspan></text></g><g><line id="actor1" x1="318" y1="5" x2="318" y2="246" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="243" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="318" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="318" dy="0">Bob</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><text x="197" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">Hello Bob, how are you?</text><line x1="75" y1="113" x2="318" y2="113" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="197" y="128" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">Great!</text><line x1="318" y1="161" x2="75" y2="161" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><g><rect x="0" y="181" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="213.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="75" dy="0">Alice</tspan></text></g><g><rect x="243" y="181" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="318" y="213.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="318" dy="0">Bob</tspan></text></g></svg></pre><h2 id="範例-3類別圖"><a class="anchor" href="#範例-3類別圖">#</a> 範例 3：類別圖</h2>
<pre class="mermaid"><svg id="mermaid-1767941303305" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="189" style="max-width: 213.375px;" viewBox="-20 -20 213.375 189"><style>#mermaid-1767941303305{font-family:"trebuchet ms",verdana,arial;font-size:16px;fill:#333;}#mermaid-1767941303305 .error-icon{fill:#552222;}#mermaid-1767941303305 .error-text{fill:#552222;stroke:#552222;}#mermaid-1767941303305 .edge-thickness-normal{stroke-width:2px;}#mermaid-1767941303305 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1767941303305 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1767941303305 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1767941303305 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1767941303305 .marker{fill:#333333;}#mermaid-1767941303305 .marker.cross{stroke:#333333;}#mermaid-1767941303305 svg{font-family:"trebuchet ms",verdana,arial;font-size:16px;}#mermaid-1767941303305 g.classGroup text{fill:#9370DB;fill:#131300;stroke:none;font-family:"trebuchet ms",verdana,arial;font-size:10px;}#mermaid-1767941303305 g.classGroup text .title{font-weight:bolder;}#mermaid-1767941303305 .classTitle{font-weight:bolder;}#mermaid-1767941303305 .node rect,#mermaid-1767941303305 .node circle,#mermaid-1767941303305 .node ellipse,#mermaid-1767941303305 .node polygon,#mermaid-1767941303305 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1767941303305 .divider{stroke:#9370DB;stroke:1;}#mermaid-1767941303305 g.clickable{cursor:pointer;}#mermaid-1767941303305 g.classGroup rect{fill:#ECECFF;stroke:#9370DB;}#mermaid-1767941303305 g.classGroup line{stroke:#9370DB;stroke-width:1;}#mermaid-1767941303305 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5;}#mermaid-1767941303305 .classLabel .label{fill:#9370DB;font-size:10px;}#mermaid-1767941303305 .relation{stroke:#333333;stroke-width:1;fill:none;}#mermaid-1767941303305 .dashed-line{stroke-dasharray:3;}#mermaid-1767941303305 #compositionStart,#mermaid-1767941303305 .composition{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1767941303305 #compositionEnd,#mermaid-1767941303305 .composition{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1767941303305 #dependencyStart,#mermaid-1767941303305 .dependency{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1767941303305 #dependencyStart,#mermaid-1767941303305 .dependency{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1767941303305 #extensionStart,#mermaid-1767941303305 .extension{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1767941303305 #extensionEnd,#mermaid-1767941303305 .extension{fill:#333333 !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1767941303305 #aggregationStart,#mermaid-1767941303305 .aggregation{fill:#ECECFF !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1767941303305 #aggregationEnd,#mermaid-1767941303305 .aggregation{fill:#ECECFF !important;stroke:#333333 !important;stroke-width:1;}#mermaid-1767941303305 .edgeTerminals{font-size:11px;}#mermaid-1767941303305:root{--mermaid-font-family:"trebuchet ms",verdana,arial;}#mermaid-1767941303305 class{fill:apa;}</style><g></g><defs><marker id="extensionStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 1,7 L18,13 V 1 Z"></path></marker></defs><defs><marker id="extensionEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 1,1 V 13 L18,7 Z"></path></marker></defs><defs><marker id="compositionStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="compositionEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="aggregationStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="aggregationEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="dependencyStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 5,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="dependencyEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><g id="classid-Animal-0" class="classGroup" transform="translate(77.0625,0 )"><rect x="0" y="0" width="51.8125" height="41" class=" "></rect><text y="15" x="0"><tspan class="title" x="9.8359375">Animal</tspan></text><line x1="0" y1="21" y2="21" x2="51.8125"></line><text x="5" y="31" fill="white" class="classText"><tspan x="5">+int age</tspan></text><line x1="0" y1="37" y2="37" x2="51.8125"></line><text x="5" y="52" fill="white" class="classText"></text></g><g id="classid-Duck-1" class="classGroup" transform="translate(0,91 )"><rect x="0" y="0" width="94.25" height="58" class=" "></rect><text y="15" x="0"><tspan class="title" x="35.3984375">Duck</tspan></text><line x1="0" y1="21" y2="21" x2="94.25"></line><text x="5" y="31" fill="white" class="classText"><tspan x="5">+String beakColor</tspan></text><line x1="0" y1="37" y2="37" x2="94.25"></line><text x="5" y="52" fill="white" class="classText"><tspan x="5">+swim()</tspan></text></g><g id="classid-Fish-2" class="classGroup" transform="translate(144.25,105 )"><rect x="0" y="0" width="29.125" height="30" class=" "></rect><text y="15" x="0"><tspan class="title" x="5">Fish</tspan></text><line x1="0" y1="21" y2="21" x2="29.125"></line><text x="5" y="31" fill="white" class="classText"></text><line x1="0" y1="26" y2="26" x2="29.125"></line><text x="5" y="41" fill="white" class="classText"></text></g><path d="M77.80837912087912,41L72.6944826007326,45.166666666666664C67.58058608058609,49.333333333333336,57.352793040293044,57.666666666666664,52.23889652014652,66C47.125,74.33333333333333,47.125,82.66666666666667,47.125,86.83333333333333L47.125,91" id="edge0" class="relation" marker-start="url(#extensionStart)"></path><path d="M128.12912087912088,41L133.2430173992674,45.166666666666664C138.35691391941393,49.333333333333336,148.58470695970695,57.666666666666664,153.69860347985346,68.33333333333333C158.8125,79,158.8125,92,158.8125,98.5L158.8125,105" id="edge1" class="relation" marker-start="url(#extensionStart)"></path></svg></pre><h2 id="範例-4-複雜流程圖"><a class="anchor" href="#範例-4-複雜流程圖">#</a> 範例 4: 複雜流程圖</h2>
<pre class="mermaid graph"><svg id="mermaid-1767941303798" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="2579.215576171875" style="max-width: 907.109375px;" viewBox="0 0 907.109375 2579.215576171875"><style>#mermaid-1767941303798{font-family:"trebuchet ms",verdana,arial;font-size:16px;fill:#333;}#mermaid-1767941303798 .error-icon{fill:#552222;}#mermaid-1767941303798 .error-text{fill:#552222;stroke:#552222;}#mermaid-1767941303798 .edge-thickness-normal{stroke-width:2px;}#mermaid-1767941303798 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1767941303798 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1767941303798 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1767941303798 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1767941303798 .marker{fill:#333333;}#mermaid-1767941303798 .marker.cross{stroke:#333333;}#mermaid-1767941303798 svg{font-family:"trebuchet ms",verdana,arial;font-size:16px;}#mermaid-1767941303798 .label{font-family:"trebuchet ms",verdana,arial;color:#333;}#mermaid-1767941303798 .label text{fill:#333;}#mermaid-1767941303798 .node rect,#mermaid-1767941303798 .node circle,#mermaid-1767941303798 .node ellipse,#mermaid-1767941303798 .node polygon,#mermaid-1767941303798 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1767941303798 .node .label{text-align:center;}#mermaid-1767941303798 .node.clickable{cursor:pointer;}#mermaid-1767941303798 .arrowheadPath{fill:#333333;}#mermaid-1767941303798 .edgePath .path{stroke:#333333;stroke-width:1.5px;}#mermaid-1767941303798 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1767941303798 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1767941303798 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1767941303798 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1767941303798 .cluster text{fill:#333;}#mermaid-1767941303798 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial;font-size:12px;background:hsl(80,100%,96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1767941303798:root{--mermaid-font-family:"trebuchet ms",verdana,arial;}#mermaid-1767941303798 flowchart{fill:apa;}</style><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath LS-Start LE-PaymentChoice" id="L-Start-PaymentChoice" style="opacity: 1;"><path class="path" d="M550.97265625,47L550.97265625,72L551.47265625,97.50000152587899" marker-end="url(#arrowhead131)" style="fill:none"></path><defs><marker id="arrowhead131" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-PaymentChoice LE-CashFlow" id="L-PaymentChoice-CashFlow" style="opacity: 1;"><path class="path" d="M492.742043192079,207.0693884679579L276.8359375,299.8000030517578L276.8359375,353.8000030517578L276.8359375,407.8000030517578L276.8359375,524.6640625L276.8359375,641.5281219482422L276.8359375,676.0281219482422" marker-end="url(#arrowhead132)" style="fill:none"></path><defs><marker id="arrowhead132" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CashFlow LE-CallAPI1" id="L-CashFlow-CallAPI1" style="opacity: 1;"><path class="path" d="M276.8359375,715.0281219482422L276.8359375,740.0281219482422L276.8359375,765.0281219482422" marker-end="url(#arrowhead133)" style="fill:none"></path><defs><marker id="arrowhead133" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-PaymentChoice LE-GetPrime" id="L-PaymentChoice-GetPrime" style="opacity: 1;"><path class="path" d="M598.4240444224598,218.84861030166138L700.73046875,299.8000030517578L700.73046875,334.3000030517578" marker-end="url(#arrowhead134)" style="fill:none"></path><defs><marker id="arrowhead134" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-GetPrime LE-PrimeResult" id="L-GetPrime-PrimeResult" style="opacity: 1;"><path class="path" d="M700.73046875,373.3000030517578L700.73046875,407.8000030517578L701.2304687499999,442.8000061035159" marker-end="url(#arrowhead135)" style="fill:none"></path><defs><marker id="arrowhead135" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-PrimeResult LE-PrimeError" id="L-PrimeResult-PrimeError" style="opacity: 1;"><path class="path" d="M743.6953453425857,565.0632545109298L825.109375,641.5281219482422L825.109375,676.0281219482422" marker-end="url(#arrowhead136)" style="fill:none"></path><defs><marker id="arrowhead136" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-PrimeResult LE-OnlineFlow" id="L-PrimeResult-OnlineFlow" style="opacity: 1;"><path class="path" d="M658.7655953042358,565.0632515542363L576.3515625,641.5281219482422L576.3515625,676.0281219482422" marker-end="url(#arrowhead137)" style="fill:none"></path><defs><marker id="arrowhead137" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-OnlineFlow LE-CallAPI2" id="L-OnlineFlow-CallAPI2" style="opacity: 1;"><path class="path" d="M576.3515625,715.0281219482422L576.3515625,740.0281219482422L576.3515625,765.0281219482422" marker-end="url(#arrowhead138)" style="fill:none"></path><defs><marker id="arrowhead138" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CallAPI1 LE-BackendValidate" id="L-CallAPI1-BackendValidate" style="opacity: 1;"><path class="path" d="M276.8359375,804.0281219482422L276.8359375,829.0281219482422L360.9695400280899,854.0281219482422" marker-end="url(#arrowhead139)" style="fill:none"></path><defs><marker id="arrowhead139" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CallAPI2 LE-BackendValidate" id="L-CallAPI2-BackendValidate" style="opacity: 1;"><path class="path" d="M576.3515625,804.0281219482422L576.3515625,829.0281219482422L492.2179599719101,854.0281219482422" marker-end="url(#arrowhead140)" style="fill:none"></path><defs><marker id="arrowhead140" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-BackendValidate LE-ValidateResult" id="L-BackendValidate-ValidateResult" style="opacity: 1;"><path class="path" d="M426.59375,893.0281219482422L426.59375,918.0281219482422L427.09375,943.5281234741208" marker-end="url(#arrowhead141)" style="fill:none"></path><defs><marker id="arrowhead141" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-ValidateResult LE-ValidationError" id="L-ValidateResult-ValidationError" style="opacity: 1;"><path class="path" d="M466.17810095153305,1015.1437725225886L642.4921875,1088.2281188964844L642.4921875,1189.3468704223633" marker-end="url(#arrowhead142)" style="fill:none"></path><defs><marker id="arrowhead142" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-ValidateResult LE-CheckPaymentType" id="L-ValidateResult-CheckPaymentType" style="opacity: 1;"><path class="path" d="M397.5316548736939,1024.666025296057L323.59375,1088.2281188964844L324.09375,1123.2281204223634" marker-end="url(#arrowhead143)" style="fill:none"></path><defs><marker id="arrowhead143" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CheckPaymentType LE-CashValidate" id="L-CheckPaymentType-CashValidate" style="opacity: 1;"><path class="path" d="M365.7295371147421,1253.8298302558637L436.4921875,1329.4656219482422L436.4921875,1363.9656219482422" marker-end="url(#arrowhead144)" style="fill:none"></path><defs><marker id="arrowhead144" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CashValidate LE-CreateCashOrder" id="L-CashValidate-CreateCashOrder" style="opacity: 1;"><path class="path" d="M436.4921875,1402.9656219482422L436.4921875,1427.9656219482422L436.4921875,1452.9656219482422" marker-end="url(#arrowhead145)" style="fill:none"></path><defs><marker id="arrowhead145" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CreateCashOrder LE-CashResponse" id="L-CreateCashOrder-CashResponse" style="opacity: 1;"><path class="path" d="M436.4921875,1491.9656219482422L436.4921875,1516.9656219482422L436.4921875,1541.9656219482422" marker-end="url(#arrowhead146)" style="fill:none"></path><defs><marker id="arrowhead146" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CheckPaymentType LE-OnlineValidate" id="L-CheckPaymentType-OnlineValidate" style="opacity: 1;"><path class="path" d="M282.4579614098265,1253.8298318321893L210.6953125,1329.4656219482422L210.6953125,1363.9656219482422" marker-end="url(#arrowhead147)" style="fill:none"></path><defs><marker id="arrowhead147" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-OnlineValidate LE-GenTxnId" id="L-OnlineValidate-GenTxnId" style="opacity: 1;"><path class="path" d="M210.6953125,1402.9656219482422L210.6953125,1427.9656219482422L210.6953125,1452.9656219482422" marker-end="url(#arrowhead148)" style="fill:none"></path><defs><marker id="arrowhead148" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-GenTxnId LE-CreateTransaction" id="L-GenTxnId-CreateTransaction" style="opacity: 1;"><path class="path" d="M210.6953125,1491.9656219482422L210.6953125,1516.9656219482422L210.6953125,1541.9656219482422" marker-end="url(#arrowhead149)" style="fill:none"></path><defs><marker id="arrowhead149" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CreateTransaction LE-MarkProcessing" id="L-CreateTransaction-MarkProcessing" style="opacity: 1;"><path class="path" d="M210.6953125,1580.9656219482422L210.6953125,1605.9656219482422L210.6953125,1630.9656219482422" marker-end="url(#arrowhead150)" style="fill:none"></path><defs><marker id="arrowhead150" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-MarkProcessing LE-CallTapPay" id="L-MarkProcessing-CallTapPay" style="opacity: 1;"><path class="path" d="M210.6953125,1669.9656219482422L210.6953125,1694.9656219482422L210.6953125,1719.9656219482422" marker-end="url(#arrowhead151)" style="fill:none"></path><defs><marker id="arrowhead151" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CallTapPay LE-TapPayResult" id="L-CallTapPay-TapPayResult" style="opacity: 1;"><path class="path" d="M210.6953125,1758.9656219482422L210.6953125,1783.9656219482422L211.1953125,1809.4656219482422" marker-end="url(#arrowhead152)" style="fill:none"></path><defs><marker id="arrowhead152" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-TapPayResult LE-MarkCompleted" id="L-TapPayResult-MarkCompleted" style="opacity: 1;"><path class="path" d="M165.25812552170285,1972.778434969945L101.796875,2052.715621948242L101.796875,2087.215621948242" marker-end="url(#arrowhead153)" style="fill:none"></path><defs><marker id="arrowhead153" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-MarkCompleted LE-CreateOrderFromTxn" id="L-MarkCompleted-CreateOrderFromTxn" style="opacity: 1;"><path class="path" d="M101.796875,2126.215621948242L101.796875,2151.215621948242L101.796875,2176.215621948242" marker-end="url(#arrowhead154)" style="fill:none"></path><defs><marker id="arrowhead154" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CreateOrderFromTxn LE-LinkOrderTxn" id="L-CreateOrderFromTxn-LinkOrderTxn" style="opacity: 1;"><path class="path" d="M101.796875,2215.215621948242L101.796875,2240.215621948242L101.796875,2265.215621948242" marker-end="url(#arrowhead155)" style="fill:none"></path><defs><marker id="arrowhead155" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-LinkOrderTxn LE-ProcessComplete" id="L-LinkOrderTxn-ProcessComplete" style="opacity: 1;"><path class="path" d="M101.796875,2304.215621948242L101.796875,2329.215621948242L101.796875,2354.215621948242" marker-end="url(#arrowhead156)" style="fill:none"></path><defs><marker id="arrowhead156" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-ProcessComplete LE-OnlineResponse" id="L-ProcessComplete-OnlineResponse" style="opacity: 1;"><path class="path" d="M101.796875,2393.215621948242L101.796875,2418.215621948242L101.796875,2443.215621948242" marker-end="url(#arrowhead157)" style="fill:none"></path><defs><marker id="arrowhead157" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-TapPayResult LE-MarkFailed" id="L-TapPayResult-MarkFailed" style="opacity: 1;"><path class="path" d="M257.1324994782972,1972.778434969945L319.59375,2052.715621948242L319.59375,2087.215621948242" marker-end="url(#arrowhead158)" style="fill:none"></path><defs><marker id="arrowhead158" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-MarkFailed LE-CleanupFailed" id="L-MarkFailed-CleanupFailed" style="opacity: 1;"><path class="path" d="M319.59375,2126.215621948242L319.59375,2151.215621948242L319.59375,2176.215621948242" marker-end="url(#arrowhead159)" style="fill:none"></path><defs><marker id="arrowhead159" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CleanupFailed LE-PaymentError" id="L-CleanupFailed-PaymentError" style="opacity: 1;"><path class="path" d="M319.59375,2215.215621948242L319.59375,2240.215621948242L319.59375,2265.215621948242" marker-end="url(#arrowhead160)" style="fill:none"></path><defs><marker id="arrowhead160" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-CashResponse LE-FrontendCash" id="L-CashResponse-FrontendCash" style="opacity: 1;"><path class="path" d="M436.4921875,1580.9656219482422L436.4921875,1605.9656219482422L436.4921875,1630.9656219482422" marker-end="url(#arrowhead161)" style="fill:none"></path><defs><marker id="arrowhead161" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-OnlineResponse LE-FrontendOnline" id="L-OnlineResponse-FrontendOnline" style="opacity: 1;"><path class="path" d="M101.796875,2482.215621948242L101.796875,2507.215621948242L101.796875,2532.215621948242" marker-end="url(#arrowhead162)" style="fill:none"></path><defs><marker id="arrowhead162" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-PaymentError LE-FrontendError" id="L-PaymentError-FrontendError" style="opacity: 1;"><path class="path" d="M319.59375,2304.215621948242L319.59375,2329.215621948242L319.59375,2354.215621948242" marker-end="url(#arrowhead163)" style="fill:none"></path><defs><marker id="arrowhead163" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-ValidationError LE-FrontendValidation" id="L-ValidationError-FrontendValidation" style="opacity: 1;"><path class="path" d="M642.4921875,1228.3468704223633L642.4921875,1329.4656219482422L642.4921875,1363.9656219482422" marker-end="url(#arrowhead164)" style="fill:none"></path><defs><marker id="arrowhead164" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-PrimeError LE-FrontendPrime" id="L-PrimeError-FrontendPrime" style="opacity: 1;"><path class="path" d="M825.109375,715.0281219482422L825.109375,740.0281219482422L825.109375,765.0281219482422" marker-end="url(#arrowhead165)" style="fill:none"></path><defs><marker id="arrowhead165" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="translate(276.8359375,407.8000030517578)" style="opacity: 1;"><g transform="translate(-32,-9.5)" class="label"><rect rx="0" ry="0" width="64.171875" height="18.53125"></rect><text><tspan xml:space="preserve" dy="1em" x="1">現場付款</tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="translate(700.73046875,299.8000030517578)" style="opacity: 1;"><g transform="translate(-40,-9.5)" class="label"><rect rx="0" ry="0" width="80.171875" height="18.53125"></rect><text><tspan xml:space="preserve" dy="1em" x="1">信用卡付款</tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="translate(825.109375,641.5281219482422)" style="opacity: 1;"><g transform="translate(-16,-9.5)" class="label"><rect rx="0" ry="0" width="32.203125" height="18.53125"></rect><text><tspan xml:space="preserve" dy="1em" x="1">失敗</tspan></text></g></g><g class="edgeLabel" transform="translate(576.3515625,641.5281219482422)" style="opacity: 1;"><g transform="translate(-16,-9.5)" class="label"><rect rx="0" ry="0" width="31.984375" height="18.53125"></rect><text><tspan xml:space="preserve" dy="1em" x="1">成功</tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="translate(642.4921875,1088.2281188964844)" style="opacity: 1;"><g transform="translate(-16,-9.5)" class="label"><rect rx="0" ry="0" width="32.203125" height="18.53125"></rect><text><tspan xml:space="preserve" dy="1em" x="1">失敗</tspan></text></g></g><g class="edgeLabel" transform="translate(323.59375,1088.2281188964844)" style="opacity: 1;"><g transform="translate(-16,-9.5)" class="label"><rect rx="0" ry="0" width="31.984375" height="18.53125"></rect><text><tspan xml:space="preserve" dy="1em" x="1">成功</tspan></text></g></g><g class="edgeLabel" transform="translate(436.4921875,1329.4656219482422)" style="opacity: 1;"><g transform="translate(-25.890625,-9.5)" class="label"><rect rx="0" ry="0" width="52.015625" height="18.53125"></rect><text><tspan xml:space="preserve" dy="1em" x="1">On-site</tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="translate(210.6953125,1329.4656219482422)" style="opacity: 1;"><g transform="translate(-23.2734375,-9.5)" class="label"><rect rx="0" ry="0" width="46.78125" height="18.53125"></rect><text><tspan xml:space="preserve" dy="1em" x="1">Online</tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="translate(101.796875,2052.715621948242)" style="opacity: 1;"><g transform="translate(-32,-9.5)" class="label"><rect rx="0" ry="0" width="63.96875" height="18.53125"></rect><text><tspan xml:space="preserve" dy="1em" x="1">付款成功</tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="translate(319.59375,2052.715621948242)" style="opacity: 1;"><g transform="translate(-32,-9.5)" class="label"><rect rx="0" ry="0" width="64.171875" height="18.53125"></rect><text><tspan xml:space="preserve" dy="1em" x="1">付款失敗</tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><text><tspan xml:space="preserve" dy="1em" x="1"></tspan></text></g></g></g><g class="nodes"><g class="node default" id="flowchart-Start-70" transform="translate(550.97265625,27.5)" style="opacity: 1;"><rect rx="0" ry="0" x="-155.015625" y="-19.5" width="310.03125" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-145.015625,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">前端：客戶填寫訂單內容 + 選擇付款方式</tspan></text></g></g></g><g class="node default" id="flowchart-PaymentChoice-71" transform="translate(550.97265625,181.1500015258789)" style="opacity: 1;"><polygon points="84.15,0 168.3,-84.15 84.15,-168.3 0,-84.15" transform="translate(-84.15,84.15)" class="label-container"></polygon><g class="label" transform="translate(0,0)"><g transform="translate(-64,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">前端判斷付款方式</tspan></text></g></g></g><g class="node default" id="flowchart-CashFlow-73" transform="translate(276.8359375,695.5281219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-74" y="-19.5" width="148" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-64,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">準備現場付款資料</tspan></text></g></g></g><g class="node default" id="flowchart-CallAPI1-75" transform="translate(276.8359375,784.5281219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-124.7578125" y="-19.5" width="249.515625" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-114.7578125,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">呼叫統一API POST /createOrder</tspan></text></g></g></g><g class="node default" id="flowchart-GetPrime-77" transform="translate(700.73046875,353.8000030517578)" style="opacity: 1;"><rect rx="0" ry="0" x="-138.734375" y="-19.5" width="277.46875" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-128.734375,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">前端：TapPay SDK 獲取 Prime Token</tspan></text></g></g></g><g class="node default" id="flowchart-PrimeResult-79" transform="translate(700.73046875,524.6640625)" style="opacity: 1;"><polygon points="82.3640625,0 164.728125,-82.3640625 82.3640625,-164.728125 0,-82.3640625" transform="translate(-82.3640625,82.3640625)" class="label-container"></polygon><g class="label" transform="translate(0,0)"><g transform="translate(-62.015625,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Prime Token 結果</tspan></text></g></g></g><g class="node default" id="flowchart-PrimeError-81" transform="translate(825.109375,695.5281219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-66" y="-19.5" width="132" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-56,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">顯示信用卡錯誤</tspan></text></g></g></g><g class="node default" id="flowchart-OnlineFlow-83" transform="translate(576.3515625,695.5281219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-74" y="-19.5" width="148" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-64,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">準備線上付款資料</tspan></text></g></g></g><g class="node default" id="flowchart-CallAPI2-85" transform="translate(576.3515625,784.5281219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-124.7578125" y="-19.5" width="249.515625" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-114.7578125,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">呼叫統一API POST /createOrder</tspan></text></g></g></g><g class="node default" id="flowchart-BackendValidate-87" transform="translate(426.59375,873.5281219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-82" y="-19.5" width="164" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-72,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">後端：驗證訂單資料</tspan></text></g></g></g><g class="node default" id="flowchart-ValidateResult-91" transform="translate(426.59375,998.3781204223633)" style="opacity: 1;"><polygon points="55.35,0 110.7,-55.35 55.35,-110.7 0,-55.35" transform="translate(-55.35,55.35)" class="label-container"></polygon><g class="label" transform="translate(0,0)"><g transform="translate(-32,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">資料驗證</tspan></text></g></g></g><g class="node default" id="flowchart-ValidationError-93" transform="translate(642.4921875,1208.8468704223633)" style="opacity: 1;"><rect rx="0" ry="0" x="-58" y="-19.5" width="116" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-48,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">返回驗證錯誤</tspan></text></g></g></g><g class="node default" id="flowchart-CheckPaymentType-95" transform="translate(323.59375,1208.8468704223633)" style="opacity: 1;"><polygon points="86.11875,0 172.2375,-86.11875 86.11875,-172.2375 0,-86.11875" transform="translate(-86.11875,86.11875)" class="label-container"></polygon><g class="label" transform="translate(0,0)"><g transform="translate(-66.1875,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">檢查 paymentType</tspan></text></g></g></g><g class="node default" id="flowchart-CashValidate-97" transform="translate(436.4921875,1383.4656219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-74" y="-19.5" width="148" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-64,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">驗證現場付款資料</tspan></text></g></g></g><g class="node default" id="flowchart-CreateCashOrder-99" transform="translate(436.4921875,1472.4656219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-70.9609375" y="-19.5" width="141.921875" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-60.9609375,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">創建 unpaid 訂單</tspan></text></g></g></g><g class="node default" id="flowchart-CashResponse-101" transform="translate(436.4921875,1561.4656219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-70.9609375" y="-19.5" width="141.921875" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-60.9609375,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">返回 unpaid 訂單</tspan></text></g></g></g><g class="node default" id="flowchart-OnlineValidate-103" transform="translate(210.6953125,1383.4656219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-74" y="-19.5" width="148" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-64,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">驗證線上付款資料</tspan></text></g></g></g><g class="node default" id="flowchart-GenTxnId-105" transform="translate(210.6953125,1472.4656219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-91.46875" y="-19.5" width="182.9375" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-81.46875,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">生成唯一 transactionId</tspan></text></g></g></g><g class="node default" id="flowchart-CreateTransaction-107" transform="translate(210.6953125,1561.4656219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-97.171875" y="-19.5" width="194.34375" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-87.171875,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Step 1: 創建 Transaction</tspan></text></g></g></g><g class="node default" id="flowchart-MarkProcessing-109" transform="translate(210.6953125,1650.4656219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-77.796875" y="-19.5" width="155.59375" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-67.796875,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Step 2: 標記處理中</tspan></text></g></g></g><g class="node default" id="flowchart-CallTapPay-111" transform="translate(210.6953125,1739.4656219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-94.5625" y="-19.5" width="189.125" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-84.5625,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Step 3: 呼叫 TapPay API</tspan></text></g></g></g><g class="node default" id="flowchart-TapPayResult-113" transform="translate(210.6953125,1913.5906219482422)" style="opacity: 1;"><polygon points="104.625,0 209.25,-104.625 104.625,-209.25 0,-104.625" transform="translate(-104.625,104.625)" class="label-container"></polygon><g class="label" transform="translate(0,0)"><g transform="translate(-86.75,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Step 4: TapPay 付款結果</tspan></text></g></g></g><g class="node default" id="flowchart-MarkCompleted-115" transform="translate(101.796875,2106.715621948242)" style="opacity: 1;"><rect rx="0" ry="0" x="-85.796875" y="-19.5" width="171.59375" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-75.796875,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Step 5: 標記付款完成</tspan></text></g></g></g><g class="node default" id="flowchart-CreateOrderFromTxn-117" transform="translate(101.796875,2195.715621948242)" style="opacity: 1;"><rect rx="0" ry="0" x="-85.796875" y="-19.5" width="171.59375" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-75.796875,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Step 6: 創建正式訂單</tspan></text></g></g></g><g class="node default" id="flowchart-LinkOrderTxn-119" transform="translate(101.796875,2284.715621948242)" style="opacity: 1;"><rect rx="0" ry="0" x="-93.796875" y="-19.5" width="187.59375" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-83.796875,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">Step 7: 關聯訂單與交易</tspan></text></g></g></g><g class="node default" id="flowchart-ProcessComplete-121" transform="translate(101.796875,2373.715621948242)" style="opacity: 1;"><rect rx="0" ry="0" x="-74" y="-19.5" width="148" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-64,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">處理付款後續邏輯</tspan></text></g></g></g><g class="node default" id="flowchart-OnlineResponse-123" transform="translate(101.796875,2462.715621948242)" style="opacity: 1;"><rect rx="0" ry="0" x="-62.21875" y="-19.5" width="124.4375" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-52.21875,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">返回 paid 訂單</tspan></text></g></g></g><g class="node default" id="flowchart-MarkFailed-125" transform="translate(319.59375,2106.715621948242)" style="opacity: 1;"><rect rx="0" ry="0" x="-58" y="-19.5" width="116" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-48,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">標記付款失敗</tspan></text></g></g></g><g class="node default" id="flowchart-CleanupFailed-127" transform="translate(319.59375,2195.715621948242)" style="opacity: 1;"><rect rx="0" ry="0" x="-58" y="-19.5" width="116" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-48,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">清理失敗交易</tspan></text></g></g></g><g class="node default" id="flowchart-PaymentError-129" transform="translate(319.59375,2284.715621948242)" style="opacity: 1;"><rect rx="0" ry="0" x="-74" y="-19.5" width="148" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-64,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">返回付款失敗錯誤</tspan></text></g></g></g><g class="node default" id="flowchart-FrontendCash-131" transform="translate(436.4921875,1650.4656219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-98" y="-19.5" width="196" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-88,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">前端：顯示等待付款確認</tspan></text></g></g></g><g class="node default" id="flowchart-FrontendOnline-133" transform="translate(101.796875,2551.715621948242)" style="opacity: 1;"><rect rx="0" ry="0" x="-82" y="-19.5" width="164" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-72,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">前端：顯示付款成功</tspan></text></g></g></g><g class="node default" id="flowchart-FrontendError-135" transform="translate(319.59375,2373.715621948242)" style="opacity: 1;"><rect rx="0" ry="0" x="-82" y="-19.5" width="164" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-72,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">前端：顯示付款失敗</tspan></text></g></g></g><g class="node default" id="flowchart-FrontendValidation-137" transform="translate(642.4921875,1383.4656219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-82" y="-19.5" width="164" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-72,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">前端：顯示驗證錯誤</tspan></text></g></g></g><g class="node default" id="flowchart-FrontendPrime-139" transform="translate(825.109375,784.5281219482422)" style="opacity: 1;"><rect rx="0" ry="0" x="-74" y="-19.5" width="148" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-64,-9.5)"><text style=""><tspan xml:space="preserve" dy="1em" x="1">前端：信用卡錯誤</tspan></text></g></g></g></g></g></g></svg></pre><h2 id="範例-5-時序圖"><a class="anchor" href="#範例-5-時序圖">#</a> 範例 5: 時序圖</h2>
<pre class="mermaid"><svg id="mermaid-1767941304665" width="100%" xmlns="http://www.w3.org/2000/svg" height="1203" style="max-width: 1480px;" viewBox="-50 -10 1480 1203"><style>#mermaid-1767941304665{font-family:"trebuchet ms",verdana,arial;font-size:16px;fill:#333;}#mermaid-1767941304665 .error-icon{fill:#552222;}#mermaid-1767941304665 .error-text{fill:#552222;stroke:#552222;}#mermaid-1767941304665 .edge-thickness-normal{stroke-width:2px;}#mermaid-1767941304665 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1767941304665 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1767941304665 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1767941304665 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1767941304665 .marker{fill:#333333;}#mermaid-1767941304665 .marker.cross{stroke:#333333;}#mermaid-1767941304665 svg{font-family:"trebuchet ms",verdana,arial;font-size:16px;}#mermaid-1767941304665 .actor{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1767941304665 text.actor &gt; tspan{fill:black;stroke:none;}#mermaid-1767941304665 .actor-line{stroke:grey;}#mermaid-1767941304665 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-1767941304665 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-1767941304665 #arrowhead path{fill:#333;stroke:#333;}#mermaid-1767941304665 .sequenceNumber{fill:white;}#mermaid-1767941304665 #sequencenumber{fill:#333;}#mermaid-1767941304665 #crosshead path{fill:#333;stroke:#333;}#mermaid-1767941304665 .messageText{fill:#333;stroke:#333;}#mermaid-1767941304665 .labelBox{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1767941304665 .labelText,#mermaid-1767941304665 .labelText &gt; tspan{fill:black;stroke:none;}#mermaid-1767941304665 .loopText,#mermaid-1767941304665 .loopText &gt; tspan{fill:black;stroke:none;}#mermaid-1767941304665 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:hsl(259.6261682243,59.7765363128%,87.9019607843%);}#mermaid-1767941304665 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-1767941304665 .noteText,#mermaid-1767941304665 .noteText &gt; tspan{fill:black;stroke:none;}#mermaid-1767941304665 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-1767941304665 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-1767941304665 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-1767941304665:root{--mermaid-font-family:"trebuchet ms",verdana,arial;}#mermaid-1767941304665 sequence{fill:apa;}</style><g></g><g><line id="actor0" x1="75" y1="5" x2="75" y2="1192" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="75" dy="0">用戶</tspan></text></g><g><line id="actor1" x1="385" y1="5" x2="385" y2="1192" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="310" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="385" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="385" dy="0">前端</tspan></text></g><g><line id="actor2" x1="711" y1="5" x2="711" y2="1192" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="636" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="711" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="711" dy="0">後端API</tspan></text></g><g><line id="actor3" x1="1105" y1="5" x2="1105" y2="1192" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1030" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1105" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="1105" dy="0">支付服務提供商</tspan></text></g><g><line id="actor4" x1="1305" y1="5" x2="1305" y2="1192" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1230" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1305" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="1305" dy="0">資料庫</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><text x="230" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">選擇支付方式並提交訂單</text><line x1="75" y1="113" x2="385" y2="113" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="548" y="128" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">POST /api/order/:orderId/payment</text><line x1="385" y1="161" x2="711" y2="161" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1008" y="176" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">檢查訂單狀態(是否為待支付)</text><line x1="711" y1="209" x2="1305" y2="209" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1008" y="224" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">返回訂單資訊</text><line x1="1305" y1="257" x2="711" y2="257" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="908" y="272" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">發起支付請求(建立交易)</text><line x1="711" y1="305" x2="1105" y2="305" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="908" y="320" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">返回支付URL/參數</text><line x1="1105" y1="353" x2="711" y2="353" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="1008" y="368" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">更新訂單狀態為"處理中"</text><line x1="711" y1="401" x2="1305" y2="401" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="548" y="416" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">返回支付URL/參數</text><line x1="711" y1="449" x2="385" y2="449" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="230" y="464" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">顯示支付頁面或重定向至支付網址</text><line x1="385" y1="497" x2="75" y2="497" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="590" y="512" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">進行支付操作</text><line x1="75" y1="545" x2="1105" y2="545" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="908" y="560" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">POST /api/order/:orderId/payment/callback</text><line x1="1105" y1="593" x2="711" y2="593" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="711" y="608" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">驗證回調請求的真實性</text><path d="M 711,641 C 771,631 771,671 711,661" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1008" y="686" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">更新訂單狀態(已支付/失敗)</text><line x1="711" y1="719" x2="1305" y2="719" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="908" y="779" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">確認收到(200 OK)</text><line x1="711" y1="812" x2="1105" y2="812" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="548" y="827" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">推送支付成功通知(可選)</text><line x1="711" y1="860" x2="385" y2="860" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="230" y="875" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">顯示支付成功頁面</text><line x1="385" y1="908" x2="75" y2="908" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="908" y="968" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">確認收到(200 OK)</text><line x1="711" y1="1001" x2="1105" y2="1001" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="548" y="1016" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">推送支付失敗通知(可選)</text><line x1="711" y1="1049" x2="385" y2="1049" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="230" y="1064" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">顯示支付失敗，提供重試選項</text><line x1="385" y1="1097" x2="75" y2="1097" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><g><line x1="65" y1="729" x2="1115" y2="729" class="loopLine"></line><line x1="1115" y1="729" x2="1115" y2="1107" class="loopLine"></line><line x1="65" y1="1107" x2="1115" y2="1107" class="loopLine"></line><line x1="65" y1="729" x2="65" y2="1107" class="loopLine"></line><line x1="65" y1="923" x2="1115" y2="923" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="65,729 115,729 115,742 106.6,749 65,749" class="labelBox"></polygon><text x="90" y="742" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">alt</text><text x="615" y="747" text-anchor="middle" class="loopText" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;"><tspan x="615">[支付成功]</tspan></text><text x="590" y="941" text-anchor="middle" class="loopText" style="font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;">[支付失敗]</text></g><g><rect x="0" y="1127" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="1159.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="75" dy="0">用戶</tspan></text></g><g><rect x="310" y="1127" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="385" y="1159.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="385" dy="0">前端</tspan></text></g><g><rect x="636" y="1127" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="711" y="1159.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="711" dy="0">後端API</tspan></text></g><g><rect x="1030" y="1127" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1105" y="1159.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="1105" dy="0">支付服務提供商</tspan></text></g><g><rect x="1230" y="1127" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1305" y="1159.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"><tspan x="1305" dy="0">資料庫</tspan></text></g></svg></pre><h1 id="保存修改重要"><a class="anchor" href="#保存修改重要">#</a> 保存修改（重要）</h1>
<p>由於修改了  <code>node_modules</code>  中的檔案，每次執行  <code>npm install</code>  或  <code>yarn install</code>  都會被覆蓋。建議使用 <strong>patch-package</strong> 保存修改：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 安裝 patch-package</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> patch-package --save-dev</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 創建補丁</span></pre></td></tr><tr><td data-num="5"></td><td><pre>npx patch-package hexo-renderer-multi-markdown-it</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 在 package.json 添加</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token string">"scripts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token string">"postinstall"</span><span class="token builtin class-name">:</span> <span class="token string">"patch-package"</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>執行後會在專案根目錄生成  <code>patches/hexo-renderer-multi-markdown-it+版本號.patch</code>  文件，未來重新安裝依賴時會自動應用補丁。</p>
<h1 id="問題根源總結"><a class="anchor" href="#問題根源總結">#</a> 問題根源總結</h1>
<p>這個問題的根本原因是<strong>多層代碼塊處理器的執行順序衝突</strong>：</p>
<ol>
<li><strong>Hexo 層</strong>：內建的  <code>highlight.js</code>  在 Markdown 渲染之前就處理了代碼塊</li>
<li><strong>Markdown-it 層</strong>： <code>markdown-it-prism</code>  覆蓋了  <code>markdown-it-mermaid</code>  的 fence 規則</li>
<li><strong>配置層</strong>： <code>markdown-it-mermaid</code>  插件未在配置中明確啟用</li>
</ol>
<p>解決方案是：</p>
<ul>
<li>禁用 Hexo 層的語法高亮，交給 markdown-it 處理</li>
<li>讓 Prism 跳過 mermaid，交給專門的 mermaid 插件處理</li>
<li>明確啟用 mermaid 插件</li>
</ul>
<h1 id="參考資料"><a class="anchor" href="#參考資料">#</a> 參考資料</h1>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv">Hexo 官方文檔</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RlYTMvaGV4by1yZW5kZXJlci1tdWx0aS1tYXJrZG93bi1pdA==">hexo-renderer-multi-markdown-it</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9tZXJtYWlkLWpzLmdpdGh1Yi5pby9tZXJtYWlkLw==">Mermaid 官方文檔</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmxpcTIuY29tL2FydGljbGUvZmYyOTAwMmU=">參考文章：Hexo 博客 + Shoka 主題 Mermaid 流程图问题</span></li>
</ul>
<h1 id="進階修復三個額外問題"><a class="anchor" href="#進階修復三個額外問題">#</a> 進階修復：三個額外問題</h1>
<p>在基本修復後，我又遇到並解決了三個額外問題。</p>
<h2 id="問題-a複雜圖表的-removechild-錯誤"><a class="anchor" href="#問題-a複雜圖表的-removechild-錯誤">#</a> 問題 A：複雜圖表的 removeChild 錯誤</h2>
<p><strong>現象</strong>：</p>
<pre><code>Error: Evaluation failed: DOMException: Failed to execute 'removeChild' on 'Node':
The node to be removed is not a child of this node.
</code></pre>
<p><strong>原因</strong>： <code>markdown-it-mermaid/index.js</code>  中移除 style 標籤的代碼假設了不正確的 DOM 結構。</p>
<p><strong>解決方案</strong>：保留 style 標籤（同時也能保留 classDef 樣式）</p>
<p><strong>檔案</strong>： <code>node_modules/hexo-renderer-multi-markdown-it/lib/renderer/markdown-it-mermaid/index.js</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 修改前（第 29-32 行）</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> svg <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token string">'#container'</span><span class="token punctuation">,</span> <span class="token parameter">container</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    container<span class="token punctuation">.</span>lastChild<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> container<span class="token punctuation">.</span>innerHTML</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// 修改後</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> svg <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token string">'#container'</span><span class="token punctuation">,</span> <span class="token parameter">container</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 保留 style 標籤，讓 classDef 自定義樣式可以正常工作</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 不再移除 style，避免丟失用戶自定義的 classDef 樣式</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> container<span class="token punctuation">.</span>innerHTML</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="問題-bclassdef-自定義顏色不顯示"><a class="anchor" href="#問題-bclassdef-自定義顏色不顯示">#</a> 問題 B：classDef 自定義顏色不顯示</h2>
<p><strong>現象</strong>：使用  <code>classDef</code>  定義的自定義顏色無效，圖表只顯示黑白。</p>
<p><strong>原因</strong>：移除 style 標籤會導致用戶自定義的  <code>classDef</code>  樣式丟失。</p>
<p><strong>解決方案</strong>：保留 style 標籤（與問題 A 的解決方案相同）。</p>
<p><strong>效果</strong>：</p>
<ul>
<li>✅ 支援 classDef 自定義顏色</li>
<li>✅ 支援 Mermaid 內建主題（default, dark, forest, neutral）</li>
</ul>
<h2 id="問題-c大圖顯示被壓縮"><a class="anchor" href="#問題-c大圖顯示被壓縮">#</a> 問題 C：大圖顯示被壓縮</h2>
<p><strong>現象</strong>：複雜的大圖（如長流程圖）被壓縮到很小的空間，內容看不清楚。</p>
<p><strong>原因</strong>：Shoka 主題的 CSS 限制了圖表最大高度為 300px。</p>
<p><strong>解決方案</strong>：移除高度限制</p>
<p><strong>檔案</strong>： <code>themes/shoka/source/css/_common/components/third-party/mermaid/mermaid.styl</code></p>
<figure class="highlight stylus"><figcaption data-lang="stylus"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token selector"><span class="token comment">// 修改前</span></pre></td></tr><tr><td data-num="2"></td><td><pre>.mermaid <span class="token punctuation">&#123;</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token selector">&amp;.graph svg<span class="token punctuation">&#123;</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property-declaration"><span class="token property">max-height</span><span class="token punctuation">:</span> <span class="token number">18.75</span><span class="token unit">rem</span><span class="token punctuation">;</span>  <span class="token comment">// 約 300px</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token selector"><span class="token comment">// 修改後</span></pre></td></tr><tr><td data-num="9"></td><td><pre>.mermaid <span class="token punctuation">&#123;</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token selector">&amp;.graph svg<span class="token punctuation">&#123;</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">//max-height: 18.75rem;  // 移除高度限制</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property-declaration"><span class="token property">max-width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span>  <span class="token comment">// 確保寬度不超出容器</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>重新生成 CSS：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>hexo clean <span class="token operator">&amp;&amp;</span> hexo generate</pre></td></tr></table></figure><h1 id="使用-classdef-自定義樣式"><a class="anchor" href="#使用-classdef-自定義樣式">#</a> 使用 classDef 自定義樣式</h1>
<p>保留 style 標籤後，我們可以使用 Mermaid 的  <code>classDef</code>  功能自定義節點顏色。</p>
<h2 id="方法-1使用-classdef-自定義顏色推薦"><a class="anchor" href="#方法-1使用-classdef-自定義顏色推薦">#</a> 方法 1：使用 classDef 自定義顏色（推薦）</h2>
<figure class="highlight markdown"><figcaption data-lang="markdown"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token code"><span class="token punctuation">```</span><span class="token code-language">mermaid</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token code-block language-mermaid">graph TD</pre></td></tr><tr><td data-num="3"></td><td><pre>    A[前端節點] --> B[後端節點]</pre></td></tr><tr><td data-num="4"></td><td><pre>    C[成功節點] --> D[錯誤節點]</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    classDef frontendClass fill:#e3f2fd,stroke:#1976d2</pre></td></tr><tr><td data-num="7"></td><td><pre>    classDef backendClass fill:#f3e5f5,stroke:#7b1fa2</pre></td></tr><tr><td data-num="8"></td><td><pre>    classDef successClass fill:#c8e6c9,stroke:#388e3c</pre></td></tr><tr><td data-num="9"></td><td><pre>    classDef errorClass fill:#ffcdd2,stroke:#d32f2f</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    class A frontendClass</pre></td></tr><tr><td data-num="12"></td><td><pre>    class B backendClass</pre></td></tr><tr><td data-num="13"></td><td><pre>    class C successClass</pre></td></tr><tr><td data-num="14"></td><td><pre>    class D errorClass</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">```</span></span></pre></td></tr></table></figure><p><strong>優點</strong>：</p>
<ul>
<li>完全自定義，可以精確控制每個節點的顏色</li>
<li>支援 Material Design 等設計系統的顏色</li>
<li>可以定義 stroke-width 等進階樣式</li>
</ul>
<h2 id="方法-2使用-mermaid-內建主題"><a class="anchor" href="#方法-2使用-mermaid-內建主題">#</a> 方法 2：使用 Mermaid 內建主題</h2>
<p>在  <code>_config.yml</code>  中設定主題：</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">markdown</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">plugins</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">-</span> <span class="token key atrule">plugin</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token key atrule">name</span><span class="token punctuation">:</span> ./markdown<span class="token punctuation">-</span>it<span class="token punctuation">-</span>mermaid</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token key atrule">options</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>          <span class="token key atrule">theme</span><span class="token punctuation">:</span> default  <span class="token comment"># 可選：default, dark, forest, neutral</span></pre></td></tr></table></figure><p><strong>主題預覽</strong>：</p>
<ul>
<li><code>default</code>  - 淺色主題，適合白色背景</li>
<li><code>dark</code>  - 深色主題，適合深色背景</li>
<li><code>forest</code>  - 綠色主題</li>
<li><code>neutral</code>  - 中性色主題</li>
</ul>
<h2 id="方法-3混合使用"><a class="anchor" href="#方法-3混合使用">#</a> 方法 3：混合使用</h2>
<p>全域使用內建主題，個別圖表使用 classDef 覆寫：</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># _config.yml</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">options</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">theme</span><span class="token punctuation">:</span> default</pre></td></tr></table></figure><figure class="highlight markdown"><figcaption data-lang="markdown"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token code"><span class="token punctuation">```</span><span class="token code-language">mermaid</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token code-block language-mermaid">graph TD</pre></td></tr><tr><td data-num="3"></td><td><pre>    A[使用預設主題] --> B[使用自定義顏色]</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    classDef customClass fill:#ff6b6b,stroke:#c92a2a</pre></td></tr><tr><td data-num="6"></td><td><pre>    class B customClass</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">```</span></span></pre></td></tr></table></figure><h1 id="補丁管理"><a class="anchor" href="#補丁管理">#</a> 補丁管理</h1>
<p>所有 node_modules 的修改已通過  <code>patch-package</code>  持久化保存：</p>
<pre><code>patches/hexo-renderer-multi-markdown-it+0.1.5.patch
</code></pre>
<p><strong>已在  <code>package.json</code>  中配置 postinstall 腳本</strong>：</p>
<figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"postinstall"</span><span class="token operator">:</span> <span class="token string">"patch-package"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token property">"patch-package"</span><span class="token operator">:</span> <span class="token string">"^8.0.1"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>每次執行  <code>npm install</code>  或  <code>yarn install</code>  後，補丁會自動應用。</p>
<h2 id="使用-yarn"><a class="anchor" href="#使用-yarn">#</a> 使用 yarn</h2>
<p>如果使用 yarn：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 1. 安裝 patch-package 和 postinstall-postinstall</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">yarn</span> <span class="token function">add</span> patch-package postinstall-postinstall <span class="token parameter variable">--dev</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 2. 創建補丁</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">yarn</span> patch-package hexo-renderer-multi-markdown-it</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 3. 配置 postinstall（package.json 中已配置）</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># "scripts": &#123; "postinstall": "patch-package" &#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 4. 驗證</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">yarn</span> <span class="token function">install</span>  <span class="token comment"># 補丁會自動應用</span></pre></td></tr><tr><td data-num="12"></td><td><pre>hexo clean <span class="token operator">&amp;&amp;</span> hexo generate</pre></td></tr></table></figure><h1 id="在其他專案中應用"><a class="anchor" href="#在其他專案中應用">#</a> 在其他專案中應用</h1>
<h2 id="方法-1複製補丁文件"><a class="anchor" href="#方法-1複製補丁文件">#</a> 方法 1：複製補丁文件</h2>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 1. 複製 patches 目錄到新專案</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">cp</span> <span class="token parameter variable">-r</span> patches /path/to/new-project/</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 2. 在新專案中安裝 patch-package</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">cd</span> /path/to/new-project</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> patch-package --save-dev</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 3. 添加 postinstall 腳本</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">npm</span> pkg <span class="token builtin class-name">set</span> <span class="token assign-left variable">scripts.postinstall</span><span class="token operator">=</span><span class="token string">"patch-package"</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 4. 安裝依賴（會自動應用補丁）</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span></pre></td></tr></table></figure><h2 id="方法-2手動應用修改"><a class="anchor" href="#方法-2手動應用修改">#</a> 方法 2：手動應用修改</h2>
<p>參考本文的修復步驟，手動修改對應文件。</p>
<h1 id="mermaid-語法兼容性"><a class="anchor" href="#mermaid-語法兼容性">#</a> Mermaid 語法兼容性</h1>
<p><strong>注意</strong>： <code>hexo-renderer-multi-markdown-it@0.1.5</code>  使用 Mermaid v8.x。</p>
<p><strong>支援的語法</strong>：</p>
<ul>
<li>✅  <code>graph TD</code>  /  <code>graph LR</code>  - 流程圖</li>
<li>✅  <code>sequenceDiagram</code>  - 序列圖</li>
<li>✅  <code>classDiagram</code>  - 類別圖</li>
<li>✅  <code>stateDiagram</code>  - 狀態圖</li>
<li>✅  <code>gantt</code>  - 甘特圖</li>
<li>✅  <code>pie</code>  - 餅圖</li>
</ul>
<p><strong>不支援的語法</strong>（Mermaid v9+ 新增）：</p>
<ul>
<li>❌  <code>flowchart TD</code>  - 使用  <code>graph TD</code>  代替</li>
<li>❌  <code>flowchart LR</code>  - 使用  <code>graph LR</code>  代替</li>
</ul>
<h1 id="已知限制"><a class="anchor" href="#已知限制">#</a> 已知限制</h1>
<ol>
<li><strong>Mermaid 版本</strong>：目前使用 mermaid v8.x，不支援 v9+ 的新語法（如  <code>flowchart</code> ）</li>
<li><strong>Puppeteer 依賴</strong>：構建時需要啟動 Chromium，構建速度較慢</li>
<li><strong>記憶體需求</strong>：複雜圖表可能需要更多記憶體</li>
</ol>
<h1 id="後記"><a class="anchor" href="#後記">#</a> 後記</h1>
<p>這次除錯過程花了不少時間，但也讓我更深入理解了 Hexo 的渲染流程和插件系統。從最初的插件衝突，到 removeChild 錯誤，再到樣式和高度限制問題，每一步都需要仔細分析和測試。</p>
<p>希望這篇文章能幫助到遇到類似問題的人。</p>
<p><strong>關鍵經驗</strong>：</p>
<ol>
<li><strong>善用 console.log</strong>：在關鍵節點添加調試輸出</li>
<li><strong>理解執行順序</strong>：找出各個處理器的加載和執行順序</li>
<li><strong>查看生成結果</strong>：實際查看生成的 HTML 來驗證問題</li>
<li><strong>保存修改</strong>：使用 patch-package 避免修改丟失</li>
<li><strong>完整測試</strong>：不僅測試基本功能，也要測試複雜場景和樣式</li>
</ol>

      <div class="tags">
          <a href="/tags/Hexo/" rel="tag"><i class="ic i-tag"></i> Hexo</a>
          <a href="/tags/Mermaid/" rel="tag"><i class="ic i-tag"></i> Mermaid</a>
          <a href="/tags/%E9%99%A4%E9%8C%AF%E7%B4%80%E9%8C%84/" rel="tag"><i class="ic i-tag"></i> 除錯紀錄</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新於</span>
    <time title="修改時間：2026-01-09 14:33:21" itemprop="dateModified" datetime="2026-01-09T14:33:21+08:00">2026-01-09</time>
  </span>
  <span id="2026/01/09/hexo-mermaid-fix/" class="item leancloud_visitors" data-flag-title="Hexo Shoka 主題 Mermaid 渲染問題排查與修復" title="閱讀次數">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">閱讀次數</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">次</span>
  </span>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>作者： </strong>Rabbir <i class="ic i-at"><em>@</em></i>プログラムを書けないうさぎは、ただのうさぎだ。
  </li>
  <li class="link">
    <strong>文章連結：</strong>
    <a href="https://rabbirreaper.github.io/2026/01/09/hexo-mermaid-fix/" title="Hexo Shoka 主題 Mermaid 渲染問題排查與修復">https://rabbirreaper.github.io/2026/01/09/hexo-mermaid-fix/</a>
  </li>
  <li class="license">
    <strong>版權聲明： </strong>本網誌所有文章除特別聲明外，均採用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 許可協議。轉載請註明出處！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2026/01/08/hello-world/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;pub-da440be71028438aa9683b63bef5ccf1.r2.dev&#x2F;69.jpg" title="Hello World">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Hello World</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2026/01/10/Shoka-%E4%B8%BB%E9%A1%8C%E5%9C%96%E7%89%87%E8%B7%AF%E5%BE%91%E5%AE%A2%E8%A3%BD%E5%8C%96%E4%BF%AE%E6%94%B9%E7%AD%86%E8%A8%98/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;pub-da440be71028438aa9683b63bef5ccf1.r2.dev&#x2F;16.jpg" title="Shoka 主題圖片路徑客製化修改筆記">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Shoka 主題圖片路徑客製化修改筆記</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目錄">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text"> 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E7%92%B0%E5%A2%83%E7%8B%80%E6%85%8B"><span class="toc-number">2.</span> <span class="toc-text"> 初始環境狀態</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#package-%E4%BE%9D%E8%B3%B4"><span class="toc-number">2.1.</span> <span class="toc-text"> Package 依賴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hexo-%E4%B8%BB%E9%85%8D%E7%BD%AE_configyml"><span class="toc-number">2.2.</span> <span class="toc-text"> Hexo 主配置（_config.yml）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shoka-%E4%B8%BB%E9%A1%8C%E9%85%8D%E7%BD%AEthemesshoka_configyml"><span class="toc-number">2.3.</span> <span class="toc-text"> Shoka 主題配置（themes&#x2F;shoka&#x2F;_config.yml）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%95%8F%E9%A1%8C%E7%8F%BE%E8%B1%A1"><span class="toc-number">3.</span> <span class="toc-text"> 問題現象</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%92%E6%9F%A5%E9%81%8E%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text"> 排查過程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%E6%AA%A2%E6%9F%A5%E7%94%9F%E6%88%90%E7%9A%84-html"><span class="toc-number">4.1.</span> <span class="toc-text"> 第一步：檢查生成的 HTML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E6%B7%BB%E5%8A%A0%E8%AA%BF%E8%A9%A6%E4%BB%A3%E7%A2%BC"><span class="toc-number">4.2.</span> <span class="toc-text"> 第二步：添加調試代碼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%E6%AA%A2%E6%9F%A5%E6%8F%92%E4%BB%B6%E8%BC%89%E5%85%A5"><span class="toc-number">4.3.</span> <span class="toc-text"> 第三步：檢查插件載入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%E5%95%9F%E7%94%A8-mermaid-%E6%8F%92%E4%BB%B6"><span class="toc-number">4.4.</span> <span class="toc-text"> 第四步：啟用 Mermaid 插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E6%AD%A5%E7%A6%81%E7%94%A8-hexo-%E5%85%A7%E5%BB%BA%E8%AA%9E%E6%B3%95%E9%AB%98%E4%BA%AE"><span class="toc-number">4.5.</span> <span class="toc-text"> 第五步：禁用 Hexo 內建語法高亮</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E6%AD%A5%E4%BF%AE%E6%94%B9-prism-%E8%B7%B3%E9%81%8E-mermaid"><span class="toc-number">4.6.</span> <span class="toc-text"> 第六步：修改 Prism 跳過 Mermaid</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E6%AD%A5%E9%A9%97%E8%AD%89%E4%BF%AE%E5%BE%A9"><span class="toc-number">4.7.</span> <span class="toc-text"> 第七步：驗證修復</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%A1%88"><span class="toc-number">5.</span> <span class="toc-text"> 完整解決方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%A6%81%E7%94%A8-hexo-%E5%85%A7%E5%BB%BA%E8%AA%9E%E6%B3%95%E9%AB%98%E4%BA%AE"><span class="toc-number">5.1.</span> <span class="toc-text"> 1. 禁用 Hexo 內建語法高亮</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%95%9F%E7%94%A8-markdown-it-mermaid-%E6%8F%92%E4%BB%B6"><span class="toc-number">5.2.</span> <span class="toc-text"> 2. 啟用 markdown-it-mermaid 插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BF%AE%E6%94%B9-prism-%E8%B7%B3%E9%81%8E-mermaid-%E8%99%95%E7%90%86"><span class="toc-number">5.3.</span> <span class="toc-text"> 3. 修改 Prism 跳過 Mermaid 處理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%8F%AF%E9%81%B8%E9%85%8D%E7%BD%AE%E5%89%8D%E7%AB%AF-mermaidjs-%E6%B8%B2%E6%9F%93"><span class="toc-number">5.4.</span> <span class="toc-text"> 4. （可選）配置前端 Mermaid.js 渲染</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">6.</span> <span class="toc-text"> 使用方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A9%97%E8%AD%89%E6%95%88%E6%9E%9C"><span class="toc-number">7.</span> <span class="toc-text"> 驗證效果</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B-1%E6%B5%81%E7%A8%8B%E5%9C%96"><span class="toc-number">7.1.</span> <span class="toc-text"> 範例 1：流程圖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B-2%E5%BA%8F%E5%88%97%E5%9C%96"><span class="toc-number">7.2.</span> <span class="toc-text"> 範例 2：序列圖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B-3%E9%A1%9E%E5%88%A5%E5%9C%96"><span class="toc-number">7.3.</span> <span class="toc-text"> 範例 3：類別圖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B-4-%E8%A4%87%E9%9B%9C%E6%B5%81%E7%A8%8B%E5%9C%96"><span class="toc-number">7.4.</span> <span class="toc-text"> 範例 4: 複雜流程圖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B-5-%E6%99%82%E5%BA%8F%E5%9C%96"><span class="toc-number">7.5.</span> <span class="toc-text"> 範例 5: 時序圖</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E4%BF%AE%E6%94%B9%E9%87%8D%E8%A6%81"><span class="toc-number">8.</span> <span class="toc-text"> 保存修改（重要）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%95%8F%E9%A1%8C%E6%A0%B9%E6%BA%90%E7%B8%BD%E7%B5%90"><span class="toc-number">9.</span> <span class="toc-text"> 問題根源總結</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99"><span class="toc-number">10.</span> <span class="toc-text"> 參考資料</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%B2%E9%9A%8E%E4%BF%AE%E5%BE%A9%E4%B8%89%E5%80%8B%E9%A1%8D%E5%A4%96%E5%95%8F%E9%A1%8C"><span class="toc-number">11.</span> <span class="toc-text"> 進階修復：三個額外問題</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%8F%E9%A1%8C-a%E8%A4%87%E9%9B%9C%E5%9C%96%E8%A1%A8%E7%9A%84-removechild-%E9%8C%AF%E8%AA%A4"><span class="toc-number">11.1.</span> <span class="toc-text"> 問題 A：複雜圖表的 removeChild 錯誤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%8F%E9%A1%8C-bclassdef-%E8%87%AA%E5%AE%9A%E7%BE%A9%E9%A1%8F%E8%89%B2%E4%B8%8D%E9%A1%AF%E7%A4%BA"><span class="toc-number">11.2.</span> <span class="toc-text"> 問題 B：classDef 自定義顏色不顯示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%8F%E9%A1%8C-c%E5%A4%A7%E5%9C%96%E9%A1%AF%E7%A4%BA%E8%A2%AB%E5%A3%93%E7%B8%AE"><span class="toc-number">11.3.</span> <span class="toc-text"> 問題 C：大圖顯示被壓縮</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-classdef-%E8%87%AA%E5%AE%9A%E7%BE%A9%E6%A8%A3%E5%BC%8F"><span class="toc-number">12.</span> <span class="toc-text"> 使用 classDef 自定義樣式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-1%E4%BD%BF%E7%94%A8-classdef-%E8%87%AA%E5%AE%9A%E7%BE%A9%E9%A1%8F%E8%89%B2%E6%8E%A8%E8%96%A6"><span class="toc-number">12.1.</span> <span class="toc-text"> 方法 1：使用 classDef 自定義顏色（推薦）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-2%E4%BD%BF%E7%94%A8-mermaid-%E5%85%A7%E5%BB%BA%E4%B8%BB%E9%A1%8C"><span class="toc-number">12.2.</span> <span class="toc-text"> 方法 2：使用 Mermaid 內建主題</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-3%E6%B7%B7%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">12.3.</span> <span class="toc-text"> 方法 3：混合使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A3%9C%E4%B8%81%E7%AE%A1%E7%90%86"><span class="toc-number">13.</span> <span class="toc-text"> 補丁管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-yarn"><span class="toc-number">13.1.</span> <span class="toc-text"> 使用 yarn</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8%E5%85%B6%E4%BB%96%E5%B0%88%E6%A1%88%E4%B8%AD%E6%87%89%E7%94%A8"><span class="toc-number">14.</span> <span class="toc-text"> 在其他專案中應用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-1%E8%A4%87%E8%A3%BD%E8%A3%9C%E4%B8%81%E6%96%87%E4%BB%B6"><span class="toc-number">14.1.</span> <span class="toc-text"> 方法 1：複製補丁文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-2%E6%89%8B%E5%8B%95%E6%87%89%E7%94%A8%E4%BF%AE%E6%94%B9"><span class="toc-number">14.2.</span> <span class="toc-text"> 方法 2：手動應用修改</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mermaid-%E8%AA%9E%E6%B3%95%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="toc-number">15.</span> <span class="toc-text"> Mermaid 語法兼容性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%B2%E7%9F%A5%E9%99%90%E5%88%B6"><span class="toc-number">16.</span> <span class="toc-text"> 已知限制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BE%8C%E8%A8%98"><span class="toc-number">17.</span> <span class="toc-text"> 後記</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
        <ul>
          <li class="active"><a href="/2026/01/09/hexo-mermaid-fix/" rel="bookmark" title="Hexo Shoka 主題 Mermaid 渲染問題排查與修復">Hexo Shoka 主題 Mermaid 渲染問題排查與修復</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="本站概要">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="Rabbir"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">Rabbir</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">86</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">11</span>
        <span class="name">分類</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">36</span>
        <span class="name">標籤</span>
      </a>
    </div>
</nav>

<div class="social">
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首頁</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>關於</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>歸檔</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>分類</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>標籤</a>
  </li>

  </ul>

</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2026/01/08/hello-world/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2026/01/10/Shoka-%E4%B8%BB%E9%A1%8C%E5%9C%96%E7%89%87%E8%B7%AF%E5%BE%91%E5%AE%A2%E8%A3%BD%E5%8C%96%E4%BF%AE%E6%94%B9%E7%AD%86%E8%A8%98/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>隨機文章</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/" title="分類於 解題紀錄">解題紀錄</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/APCS/" title="分類於 APCS">APCS</a>
</div>

    <span><a href="/2025/01/18/b967-4-%E8%A1%80%E7%B7%A3%E9%97%9C%E4%BF%82/" title="b967. 4. 血緣關係">b967. 4. 血緣關係</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/" title="分類於 解題紀錄">解題紀錄</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/%E5%85%B6%E4%BB%96/" title="分類於 其他">其他</a>
</div>

    <span><a href="/2025/01/18/a164-%E5%9C%98%E9%AB%94%E4%BD%87%E5%88%97/" title="a164 團體佇列">a164 團體佇列</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/" title="分類於 解題紀錄">解題紀錄</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/APCS/" title="分類於 APCS">APCS</a>
</div>

    <span><a href="/2025/01/18/b965-2-%E7%9F%A9%E9%99%A3%E8%BD%89%E6%8F%9B/" title="b965. 2. 矩陣轉換">b965. 2. 矩陣轉換</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/" title="分類於 解題紀錄">解題紀錄</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/APCS/" title="分類於 APCS">APCS</a>
</div>

    <span><a href="/2025/01/18/k734-4-%E9%96%8B%E5%95%9F%E5%AF%B6%E7%9B%92/" title="k734. 4. 開啟寶盒">k734. 4. 開啟寶盒</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%8A%A0%E5%AF%86%E6%96%87%E7%AB%A0/" title="分類於 加密文章">加密文章</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E5%8A%A0%E5%AF%86%E6%96%87%E7%AB%A0/%E6%97%A5%E6%9C%9F/" title="分類於 日期">日期</a>
</div>

    <span><a href="/2025/11/08/251108/" title="251108">251108</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2025/04/28/Vue-%E6%B8%AC%E8%A9%A6%E7%AD%86%E8%A8%98/" title="Vue 測試筆記 (未完成)">Vue 測試筆記 (未完成)</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/" title="分類於 解題紀錄">解題紀錄</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/AP325/" title="分類於 AP325">AP325</a>
</div>

    <span><a href="/2025/01/18/Q-6-5-%E4%BA%8C%E7%B6%AD%E6%9C%80%E5%A4%A7%E5%AD%90%E7%9F%A9%E9%99%A3/" title="Q-6-5. 二維最大子矩陣">Q-6-5. 二維最大子矩陣</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80%E7%AD%86%E8%A8%98/" title="分類於 程式語言筆記">程式語言筆記</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80%E7%AD%86%E8%A8%98/node-js/" title="分類於 node.js">node.js</a>
</div>

    <span><a href="/2025/01/22/cookie-parser-%E8%AA%9E%E6%B3%95%E7%AD%86%E8%A8%98/" title="cookie-parser 語法筆記">cookie-parser 語法筆記</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/" title="分類於 解題紀錄">解題紀錄</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/APCS-%E6%A8%A1%E6%93%AC%E5%9C%98%E9%9A%8A/" title="分類於 APCS 模擬團隊">APCS 模擬團隊</a>
</div>

    <span><a href="/2025/01/18/apcs0203-S-%E7%9B%92%E6%A8%A1%E6%93%AC-S-BOX-Simulate/" title="apcs0203:S 盒模擬 (S-BOX-Simulate)">apcs0203:S 盒模擬 (S-BOX-Simulate)</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/" title="分類於 解題紀錄">解題紀錄</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E8%A7%A3%E9%A1%8C%E7%B4%80%E9%8C%84/APCS-%E6%A8%A1%E6%93%AC%E5%9C%98%E9%9A%8A/" title="分類於 APCS 模擬團隊">APCS 模擬團隊</a>
</div>

    <span><a href="/2025/01/18/apcs0204-%E9%80%83%E8%84%AB%E9%81%8A%E6%88%B2-Game/" title="apcs0204:逃脫遊戲 (Game)">apcs0204:逃脫遊戲 (Game)</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>最新評論</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2025 – 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Rabbir @ Rabbir Reaper</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="總字數">301k 字</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="所需總閱讀時間">4:34</span>
  </div>
  <div class="powered-by">
    基於 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2026/01/09/hexo-mermaid-fix/',
    favicon: {
      show: "（●´3｀●）復活成功",
      hide: "(´Д｀)瀏覽器崩潰啦"
    },
    search : {
      placeholder: "文章搜尋",
      empty: "關於 「 ${query} 」 ，什麼也沒搜到",
      stats: "${time} ms 內找到 ${hits} 條結果"
    },
    valine: true,fancybox: true,
    copyright: '複製成功，轉載請遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 協議。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
